async function downloadPDF() {
    const { jsPDF } = window.jspdf;
    const element = document.getElementById('content-container');
    
    // Étape 1 : Préparation de l'élément pour éviter le zoom
    const originalStyles = {
        borderRadius: element.style.borderRadius,
        boxShadow: element.style.boxShadow,
        transform: element.style.transform
    };
    
    // On retire temporairement les arrondis et ombres qui perdent le script
    element.style.borderRadius = "0px";
    element.style.boxShadow = "none";
    element.style.transform = "none";

    try {
        const canvas = await html2canvas(element, { 
            scale: 2, 
            useCORS: true, 
            backgroundColor: "#FFF5E1",
            // On force la capture à partir du haut de l'élément, peu importe le scroll
            scrollY: -window.scrollY,
            scrollX: -window.scrollX,
            windowWidth: document.documentElement.offsetWidth,
            windowHeight: document.documentElement.offsetHeight
        });

        const imgData = canvas.toDataURL('image/jpeg', 0.95);
        const pdf = new jsPDF('p', 'mm', 'a4');
        
        const pageWidth = pdf.internal.pageSize.getWidth();
        const pageHeight = pdf.internal.pageSize.getHeight();
        
        // Ajustement précis à la page A4
        const imgWidth = pageWidth - 20; // 10mm de marge de chaque côté
        const imgHeight = (canvas.height * imgWidth) / canvas.width;

        pdf.addImage(imgData, 'JPEG', 10, 10, imgWidth, imgHeight);
        pdf.save(`Journal-${currentViewDate}.pdf`);

    } catch (err) {
        console.error("Erreur capture:", err);
        alert("Utilisez le bouton 'Imprimer Tout' et choisissez 'Enregistrer en PDF' pour un résultat garanti.");
    } finally {
        // Étape 2 : On remet le joli design (arrondis et ombres)
        element.style.borderRadius = originalStyles.borderRadius;
        element.style.boxShadow = originalStyles.boxShadow;
        element.style.transform = originalStyles.transform;
    }
}
