<script>
    // Initialisation de la m√©moire locale
    let state = JSON.parse(localStorage.getItem('faithJournal_vFinal_Master')) || {
        monthlyData: {},
        weeklyRituals: {},
        dailyLogs: {},
        moodHistory: [],
        // C'est ici que D√©cembre et les visions globales sont stock√©s
        globalVision: {
            decRef: "", decInt: "", decGoals: "",
            q1: "", q2: "", q3: "",
            gratitude: "", affirmation: ""
        }
    };
    
    let currentViewDate = new Date().toISOString().split('T')[0];
    let selectedSticker = null;

    const pages = {
        cover: () => `<div class="text-center py-24"><i data-lucide="moon" class="mx-auto mb-8 text-indigo-200" size="80"></i><h1 class="serif text-6xl font-bold mb-4 text-indigo-950">2026<br>Faith & Intention</h1><p class="text-2xl text-gray-400 italic">By NancieDee</p></div>`,
        
        december: () => `
            <h2 class="serif text-3xl mb-10 text-center">D√©cembre 2025 ‚Äì Vision & R√©flexion</h2>
            <div class="space-y-8">
                <div class="p-8 rounded-3xl bg-white/40 border border-white">
                    <label class="serif text-xl block mb-4 italic text-indigo-900">Retour sur l'ann√©e pr√©c√©dente</label>
                    <textarea oninput="saveGlobal('decRef', this.value)" class="w-full h-48 bg-transparent border-none focus:ring-0">${state.globalVision.decRef || ''}</textarea>
                </div>
                <div class="grid md:grid-cols-2 gap-8">
                    <div class="p-8 rounded-3xl bg-[#D9C1EB]/20 border border-white">
                        <label class="font-bold text-xs uppercase tracking-widest block mb-4">Intentions 2026</label>
                        <textarea oninput="saveGlobal('decInt', this.value)" class="w-full h-40 bg-transparent border-none">${state.globalVision.decInt || ''}</textarea>
                    </div>
                    <div class="p-8 rounded-3xl bg-[#BFD8EB]/20 border border-white">
                        <label class="font-bold text-xs uppercase tracking-widest block mb-4">Grands Objectifs</label>
                        <textarea oninput="saveGlobal('decGoals', this.value)" class="w-full h-40 bg-transparent border-none">${state.globalVision.decGoals || ''}</textarea>
                    </div>
                </div>
            </div>`,

        daily: () => {
            const dayData = state.dailyLogs[currentViewDate] || { energy: 50, movement: 50, prayer: 50, connection: 50, note: "" };
            return `
            <div class="flex flex-col md:flex-row justify-between items-center mb-10 p-8 bg-[#BFD8EB]/30 rounded-[2.5rem] border border-white gap-4">
                <div>
                    <h2 class="serif text-3xl">Daily Tracker</h2>
                    <div class="flex items-center gap-2 mt-2">
                        <input type="date" value="${currentViewDate}" onchange="changeDailyDate(this.value)" class="bg-white/80 border-none rounded-lg p-2 font-bold text-indigo-600 shadow-sm">
                        <button onclick="changeDailyDate(new Date().toISOString().split('T')[0])" class="p-2 bg-indigo-600 text-white rounded-lg text-xs font-bold">Aujourd'hui</button>
                    </div>
                </div>
                <div class="text-center p-4 bg-white/50 rounded-2xl border border-white min-w-[100px]">
                    <p class="text-[9px] font-bold text-gray-400 uppercase">Score du jour</p>
                    <p class="serif text-2xl text-indigo-600">${Math.round((dayData.energy+dayData.movement+dayData.prayer+dayData.connection)/4)}%</p>
                </div>
            </div>
            <div class="grid md:grid-cols-2 gap-12">
                <div class="space-y-10">
                    ${['energy', 'movement', 'prayer', 'connection'].map(cat => `
                        <div>
                            <div class="flex justify-between mb-3"><label class="font-bold text-indigo-900 capitalize">${cat}</label><span class="text-xs font-bold text-indigo-400" id="val-${cat}">${dayData[cat]}%</span></div>
                            <input type="range" value="${dayData[cat]}" onchange="updateDaily('${cat}', this.value)" oninput="document.getElementById('val-${cat}').innerText=this.value+'%'">
                        </div>`).join('')}
                </div>
                <textarea oninput="updateDaily('note', this.value)" class="p-8 rounded-[2.5rem] bg-white border border-white shadow-inner min-h-[300px]" placeholder="Vos r√©flexions du jour...">${dayData.note || ""}</textarea>
            </div>`;
        },

        emotional: () => `
            <h2 class="serif text-3xl mb-10 text-center">Succ√®s √âmotionnel</h2>
            <div class="max-w-2xl mx-auto space-y-8">
                <div class="bg-indigo-950 text-white p-10 rounded-[3rem] shadow-2xl">
                    <p class="text-xs font-bold opacity-40 mb-8 uppercase tracking-widest text-center">Humeur</p>
                    <div class="flex justify-between mb-8">
                        ${['üåà', '‚òÄÔ∏è', '‚òÅÔ∏è', 'üåßÔ∏è', '‚õàÔ∏è'].map(m => `<button onclick="saveMood('${m}')" class="text-5xl hover:scale-125 transition">${m}</button>`).join('')}
                    </div>
                </div>
                <div class="p-8 bg-white/40 rounded-3xl border border-white">
                    <label class="font-bold block mb-3 text-indigo-900">Ma Gratitude (Vision 2026)</label>
                    <textarea oninput="saveGlobal('gratitude', this.value)" class="w-full bg-transparent border-none italic h-24">${state.globalVision.gratitude || ''}</textarea>
                </div>
                <div class="p-8 bg-white/40 rounded-3xl border border-white">
                    <label class="font-bold block mb-3 text-indigo-900">Mon Affirmation Ma√Ætresse</label>
                    <input type="text" oninput="saveGlobal('affirmation', this.value)" value="${state.globalVision.affirmation || ''}" class="w-full bg-transparent border-none text-lg">
                </div>
            </div>`
    };

    // --- LOGIQUE DE SAUVEGARDE ---

    // Sauvegarde pour les pages globales (D√©cembre, Gratitude, Affirmation)
    function saveGlobal(key, value) {
        state.globalVision[key] = value;
        save();
    }

    // Sauvegarde pour le Tracker Quotidien (li√© aux dates)
    function updateDaily(key, value) {
        if(!state.dailyLogs[currentViewDate]) {
            state.dailyLogs[currentViewDate] = {energy:50, movement:50, prayer:50, connection:50, note:""};
        }
        state.dailyLogs[currentViewDate][key] = (key === 'note' ? value : parseInt(value));
        save();
    }

    function changeDailyDate(d) {
        currentViewDate = d;
        showPage('daily');
    }

    function save() {
        localStorage.setItem('faithJournal_vFinal_Master', JSON.stringify(state));
    }

    function showPage(id) {
        document.getElementById('content-container').innerHTML = pages[id]();
        lucide.createIcons();
    }

    // Chargement initial
    showPage('cover');
</script>
